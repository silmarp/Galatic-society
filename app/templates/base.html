<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %} {% endblock%}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    <div class="wrapper d-flex flex-column min-vh-100">
      {% include 'navbar.html' %}

      <main class="flex-fill">
          <div class="container">
            {% block content %} {% endblock%}
          </div>
      </main>

      <!-- Toast Container -->
      <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

      <!-- Bootstrap JS and dependencies -->
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.min.js"></script>
      <script>
          function generateUUID() {
            // Gera um ID único
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
          }

          document.addEventListener("DOMContentLoaded", function() {
              const messages = {{ get_flashed_messages(with_categories=true) | tojson }};
              if (messages.length > 0) {
                  const toastContainer = document.querySelector('.toast-container');
                  messages.forEach(([category, message]) => {
                      const toastElement = document.createElement('div');
                      toastElement.classList.add('toast', 'show', 'bg-danger', 'text-white');
                      const toastId = generateUUID();
                      toastElement.id = toastId;
                      toastElement.setAttribute('role', 'alert');
                      toastElement.setAttribute('aria-live', 'assertive');
                      toastElement.setAttribute('aria-atomic', 'true');
                      toastElement.innerHTML = `
                          <div class="toast-header">
                            <strong class="me-auto">Atenção</strong>
                            <small class="text-muted">agora</small>
                            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                          </div>
                          <div class="toast-body">
                            ${message}
                          </div>
                      `;
                      toastContainer.appendChild(toastElement);
                      setTimeout(function() {
                        toastElement.remove();
                      }, 3000);
                  });
              }
          });
      </script>
      
      {% include 'footer.html' %}
  </div>
  </body>
</html>
